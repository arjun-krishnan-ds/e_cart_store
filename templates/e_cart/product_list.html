{% extends 'core/base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'e_cart/css/category.css' %}?v=10">
{% endblock %}

{% block content %}
<div class="container my-4">

  <div class="row g-4">

    <!-- =========================
        LEFT SIDEBAR
    ========================== -->
    <aside class="col-lg-3 col-md-4">

      <div class="category-box">

        <h5>Categories</h5>

        <!-- Search input -->
        <input type="text" id="categorySearch" class="form-control mb-3" 
               placeholder="Search categories..." value="{{ search_query|default:'' }}">

        {% for category in categories %}
        <div class="category-group {% if selected_category_id == category.id %}active{% endif %}">

          <div class="category-title">
            {{ category.name }}
            <i class="fa-solid fa-chevron-down"></i>
          </div>

          {% if category.children.all %}
          <ul class="subcategory-list">
            {% for sub in category.children.all %}
            <li class="subcategory-item">
              <a href="?category={{ sub.id }}">{{ sub.name }}</a>
            </li>
            {% endfor %}
          </ul>
          {% endif %}

        </div>
        {% endfor %}

      </div>

    </aside>

    <!-- =========================
        PRODUCT GRID
    ========================== -->
    <section class="col-lg-9 col-md-8">

      <div id="product-container" class="row g-4">

        {% for product in products %}
        <div class="col-xl-4 col-lg-4 col-md-6 col-sm-6">

          <div class="product-card">

            <!-- IMAGE -->
            <div class="product-img-wrapper">
              {% if product.image %}
              <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-img" loading="lazy">
              {% else %}
              <img src="{% static 'core/img/placeholder.png' %}" alt="No image" class="product-img">
              {% endif %}
            </div>

            <!-- BODY -->
            <div class="product-body">
              <h6 class="product-title">{{ product.name }}</h6>
              <div class="product-price">₹ {{ product.price }}</div>
            </div>

            <!-- ACTIONS -->
            <div class="product-actions">

              <a href="{% url 'product_detail' product.id %}" class="btn btn-sm btn-primary">
                View
              </a>

              <!-- ✅ Cart Button -->
              <button class="btn btn-warning btn-sm btn-add-cart" data-id="{{ product.id }}"
                aria-label="Add {{ product.name }} to cart">
                Add to Cart
              </button>

            </div>

          </div>

        </div>
        {% empty %}
        <div class="col-12 text-center text-muted py-5">
          No products available.
        </div>
        {% endfor %}

      </div>

      <!-- Loader (future infinite scroll / ajax) -->
      <div id="loader" class="text-center py-4" style="display:none;">
        <i class="fa fa-spinner fa-spin fa-2x"></i>
      </div>

    </section>

  </div>

</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'e_cart/js/category.js' %}?v=10"></script>
{% endblock %}
